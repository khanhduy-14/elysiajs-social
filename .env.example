# Environment Variables for Cloud Deployment

This file lists all environment variables needed for deploying to cloud platforms.

## Required Environment Variables

### Application Settings

```bash
# Node Environment
NODE_ENV=production

# Port (required by most platforms)
PORT=3000

# Log Level
LOG_LEVEL=info
```

### Database Configuration

**Option 1: Using DATABASE_URL (recommended for Railway, Render)**
```bash
DATABASE_URL=postgresql://user:password@host:port/database
```

**Option 2: Individual Variables (Fly.io, custom setup)**
```bash
PGHOST=your-db-host.internal
PGPORT=5432
PGUSER=postgres
PGPASSWORD=your-secure-password
PGDATABASE=social-db
```

### Authentication & Security

```bash
# RSA Keys for JWT (use \n for newlines or actual multiline in platform UI)
RSA_PRIVATE_KEY="-----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEA...
-----END RSA PRIVATE KEY-----"

RSA_PUBLIC_KEY="-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA...
-----END PUBLIC KEY-----"

# App Secrets (generate secure random strings)
APP_SECRET=generate-a-secure-random-string-here
JWT_ACCESS_SECRET=another-secure-random-string
JWT_REFRESH_SECRET=yet-another-secure-random-string

# Password Hashing
PASSWORD_SALT_LENGTH=10
```

## Platform-Specific Setup

### Railway

Railway automatically provides database variables when you add PostgreSQL:

**Auto-provided:**
- `DATABASE_URL`
- `PGHOST`, `PGPORT`, `PGUSER`, `PGPASSWORD`, `PGDATABASE`

**You need to add:**
- `NODE_ENV=production`
- `PORT=3000`
- `RSA_PRIVATE_KEY`
- `RSA_PUBLIC_KEY`
- `APP_SECRET`
- `JWT_ACCESS_SECRET`
- `JWT_REFRESH_SECRET`

**How to add:**
1. Go to your Railway project
2. Select your service
3. Go to **Variables** tab
4. Click **+ New Variable**
5. Add each variable

### Render

**From Database (auto-provided when linked):**
- `DATABASE_URL`

**You need to add:**
- All variables from Railway list above

**How to add:**
1. Go to your web service
2. Click **Environment**
3. Add each variable
4. Click **Save Changes**

### Fly.io

**From attached Postgres (auto-provided):**
- `DATABASE_URL`

**You need to add using Fly Secrets:**

```bash
# Add secrets via CLI
fly secrets set NODE_ENV=production
fly secrets set PORT=3000
fly secrets set APP_SECRET=your-secret
fly secrets set JWT_ACCESS_SECRET=your-secret
fly secrets set JWT_REFRESH_SECRET=your-secret

# Add RSA keys (use actual files)
fly secrets set RSA_PRIVATE_KEY="$(cat rsa-private.pem)"
fly secrets set RSA_PUBLIC_KEY="$(cat rsa-public.pem)"
```

## Generating Secure Values

### Generate RSA Keys

```bash
# Generate private key (2048-bit)
openssl genrsa -out rsa-private.pem 2048

# Generate public key from private key
openssl rsa -in rsa-private.pem -pubout -out rsa-public.pem

# View private key (copy entire output including BEGIN/END lines)
cat rsa-private.pem

# View public key (copy entire output including BEGIN/END lines)
cat rsa-public.pem
```

### Generate Random Secrets

**Linux/Mac:**
```bash
# Generate a secure random string (32 characters)
openssl rand -base64 32

# Or use Node.js
node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"
```

**Online:**
- Use: https://www.random.org/strings/
- Or: https://1password.com/password-generator/

## Environment Variable Checklist

Before deploying, ensure you have set:

- [ ] `NODE_ENV=production`
- [ ] `PORT=3000`
- [ ] `DATABASE_URL` or individual `PG*` variables
- [ ] `RSA_PRIVATE_KEY`
- [ ] `RSA_PUBLIC_KEY`
- [ ] `APP_SECRET`
- [ ] `JWT_ACCESS_SECRET`
- [ ] `JWT_REFRESH_SECRET`

## Testing Locally

Create a `.env` file (DO NOT commit to git):

```bash
NODE_ENV=development
PORT=3000
PGHOST=localhost
PGPORT=5432
PGUSER=admin
PGPASSWORD=your-password
PGDATABASE=social-db
RSA_PRIVATE_KEY=<content-from-file>
RSA_PUBLIC_KEY=<content-from-file>
APP_SECRET=local-dev-secret
JWT_ACCESS_SECRET=local-jwt-access
JWT_REFRESH_SECRET=local-jwt-refresh
```

**Note:** `.env` is in `.gitignore` - never commit secrets!

## Troubleshooting

### Issue: Database connection fails

**Check:**
1. DATABASE_URL format is correct
2. Database is running (check platform dashboard)
3. Database credentials are correct
4. Network/firewall rules allow connection

### Issue: JWT signing fails

**Check:**
1. RSA_PRIVATE_KEY includes BEGIN/END lines
2. No extra spaces or line breaks
3. Key is valid (test locally first)

### Issue: App crashes on startup

**Check:**
1. All required environment variables are set
2. PORT is set correctly
3. Check application logs in platform dashboard
4. Verify Dockerfile CMD is correct

## Security Notes

⚠️ **Never commit these to git:**
- RSA private/public keys
- Database passwords
- JWT secrets
- API tokens

✅ **Best practices:**
- Use different secrets for each environment
- Rotate secrets regularly
- Use platform secret management features
- Keep `.env` in `.gitignore`
- Use strong, random values (not default examples)

---

For more help, see [DEPLOYMENT.md](../DEPLOYMENT.md)
